<!-- postList.wxml -->
<view class="container">
  <!-- å¸–å­åˆ—è¡¨ -->
  <block wx:for="{{posts}}" wx:key="_id">
    <view class="post-card">
      <!-- å¸–å­å†…å®¹ -->
      <view class="post-content">
        <text class="username">{{item.author}}</text>
        <text class="time">{{formatTime(item.createTime)}}</text>
        <text class="text-content">{{item.content}}</text>
        <!-- å›¾ç‰‡å±•ç¤º -->
        <block wx:for="{{item.images}}" wx:key="url">
          <image src="{{item.url}}" mode="aspectFill" class="post-image"/>
        </block>
        <!-- è¯„è®ºå…¥å£ -->
        <button class="comment-btn" bindtap="toggleComments" data-id="{{item._id}}">
          <text class="comment-count">{{item.comments.length}}æ¡è¯„è®º</text>
        </button>
        
        <!-- è¯„è®ºåˆ—è¡¨ -->
        <view class="comment-list" a:if="{{showComments[item._id]}}">
          <block wx:for="{{item.comments}}" wx:key="_id">
            <view class="comment-item">
              <view class="user-info">
                <text class="nickname">{{item.commenter}}</text>
                <text class="time">{{formatTime(item.commentTime)}}</text>
              </view>
              <view class="comment-content">
                {{item.commentContent}}
                <!-- å›å¤æ ‡è®° -->
                <view wx:if="{{item.replyTo}}" class="reply-tag">
                  å›å¤ @{{item.replyTo}}
                </view>
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- è¾“å…¥åŒºåŸŸ -->
      <view class="input-area" hidden="{{!showComments[item._id]}}">
        <view class="mention-list" a:if="{{mentionList.length}}">
          <block wx:for="{{mentionList}}" wx:key="id">
            <view class="mention-item" bindtap="insertMention" data-user="{{item.name}}">
              {{item.name}}
            </view>
          </block>
        </view>
        
        <textarea 
          class="comment-input"
          placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."
          value="{{inputValue}}"
          bindinput="onInput"
          maxlength="300"
          bindconfirm="submitComment"
        />
        
        <view class="toolbar">
          <button class="emoji-btn" bindtap="toggleEmojiPicker">ğŸ˜Š</button>
          <button class="send-btn" bindtap="submitComment">å‘é€</button>
        </view>
      </view>
    </view>
  </block>

  <!-- è¡¨æƒ…é¢æ¿ -->
  <view class="emoji-panel" hidden="{{!showEmoji}}">
    <block wx:for="{{emojis}}" wx:key="unicode">
      <emoji emoji="{{item.unicode}}" bindtap="insertEmoji"/>
    </block>
  </view>
</view>